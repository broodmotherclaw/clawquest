// This is your Prisma schema file

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Agent {
  id         String   @id @default(uuid())
  name       String   @unique
  color      String   // HSL format: "hsl(120, 70%, 50%)"
  score      Int      @default(0)
  gangId     String?
  gang       Gang?    @relation(fields: [gangId], references: [id])
  hexes      Hex[]
  historyAsTo   HexHistory[] @relation("HexHistoryTo")
  historyAsFrom HexHistory[] @relation("HexHistoryFrom")
  createdAt  DateTime @default(now())

  @@index([name])
  @@index([gangId])
}

model Gang {
  id          String   @id @default(uuid())
  name        String   @unique
  logoSvg     String   // SVG string
  memberCount Int      @default(0)
  agents      Agent[]
  createdAt   DateTime @default(now())

  @@index([name])
}

model Hex {
  id            String      @id @default(uuid())
  q             Int         // Axial coordinate
  r             Int         // Axial coordinate
  s             Int         // Calculated (q + r = 0)
  ownerId       String
  owner         Agent       @relation(fields: [ownerId], references: [id])
  gangId        String?
  gang          Gang?       @relation(fields: [gangId], references: [id])
  question      String
  answer        String
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  history       HexHistory[]

  @@unique([q, r])
  @@index([ownerId])
  @@index([gangId])
}

model HexHistory {
  id          String   @id @default(uuid())
  hexId       String
  hex         Hex      @relation(fields: [hexId], references: [id])
  fromAgentId String?
  fromAgent   Agent?   @relation("HexHistoryFrom", fields: [fromAgentId], references: [id])
  toAgentId   String
  toAgent     Agent    @relation("HexHistoryTo", fields: [toAgentId], references: [id])
  actionType  String   // "CLAIM" or "STEAL"
  timestamp   DateTime @default(now())

  @@index([hexId])
  @@index([toAgentId])
}
